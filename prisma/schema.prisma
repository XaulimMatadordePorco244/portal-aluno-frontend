datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  ALUNO
  ADMIN
}

enum TipoCargo {
  POSTO
  GRADUACAO
  CURSO
}

enum ClasseOficial {
  SUPERIOR
  INTERMEDIARIO
  SUBALTERNO
}

enum CategoriaCargo {
  FORMACAO
  QUADRO
}

model User {
  id           String   @id @default(cuid())
  cpf          String   @unique
  password     String
  nome         String
  numero       String?  @unique
  companhia    String?
  conceito     String?
  anoIngresso  Int?
  email        String?  @unique
  status       String   @default("Ativo")
  fotoUrl      String?
  validationId String   @unique @default(cuid())
  nomeDeGuerra String?
  cargoId      String?
  funcaoId     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  passwordResetToken       String?   @unique
  passwordResetExpires     DateTime?

  anotacoesRecebidas Anotacao[] @relation("AnotacoesDoAluno")
  anotacoesFeitas    Anotacao[] @relation("AnotacoesFeitasPeloAutor")
  funcao             Funcao?    @relation(fields: [funcaoId], references: [id])
  cargo              Cargo?     @relation(fields: [cargoId], references: [id])
  qesCriados         QES[]
  role               Role       @default(ALUNO)
}

model Regulamento {
  id         String  @id @default(cuid())
  titulo     String
  arquivoUrl String
  ativo      Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TipoDeAnotacao {
  id                String  @id @default(cuid())
  titulo            String  @unique
  descricao         String  @db.Text
  pontos            Float?
  abertoCoordenacao Boolean @default(false)

  registros Anotacao[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Anotacao {
  id       String   @id @default(cuid())
  pontos   Float
  detalhes String?  @db.Text
  data     DateTime

  tipo   TipoDeAnotacao @relation(fields: [tipoId], references: [id])
  tipoId String

  aluno   User   @relation("AnotacoesDoAluno", fields: [alunoId], references: [id])
  alunoId String

  autor   User   @relation("AnotacoesFeitasPeloAutor", fields: [autorId], references: [id])
  autorId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model QES {
  id         String @id @default(cuid())
  titulo     String
  arquivoUrl String
  autorId    String
  autor      User   @relation(fields: [autorId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cargo {
  id          String         @id @default(cuid())
  nome        String         @unique
  abreviacao  String         @unique
  codigo      Int?            
  categoria   CategoriaCargo
  tipo        TipoCargo
  precedencia Int            @unique
  classe      ClasseOficial?
  usuarios    User[]
  divisaUrl   String?
}

model Funcao {
  id       String @id @default(cuid())
  nome     String @unique
  usuarios User[]
}
